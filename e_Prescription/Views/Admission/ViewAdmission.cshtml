@model IEnumerable<e_Prescription.Models.Admission>

@{
    ViewData["Title"] = "Admitted Patient";
}

<style>
    /* Your existing styles */
</style>

<div class="col-12 mx-auto pt-0 p-0">
    <div class="card justify-content-center">
        <div class="card-header bg-success text-uppercase text-white" style="height: 45px;">
            <h4 class="text-center">Admission</h4>
        </div>

        <form asp-action="ViewAdmission" method="get" class="form form-border align-content-center">
            <br />
            <div class="row">
                <br />
                <div class="col-md-6 offset-md-3">
                    <form asp-action="ViewAdmission" asp-controller="Admission" class="d-flex justify-content-center" method="get" enctype="multipart/form-data" style="width: 100%;">
                        <div class="d-flex justify-content-center w-100">
                            <div class="form-group mb-2 mr-3 d-flex align-items-center">
                                <input type="text" class="form-control mr-2" placeholder="Enter ID Number" id="patientId" name="patientId">
                                <button type="submit" class="btn btn-primary">Search</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </form>


        @if (Model != null && Model.Any())
        {
            <table class="table table-striped table-sm">
                <thead>
                    <tr>
                        <th>ID Number</th>
                        <th>Surname</th>
                        <th>Gender</th>
                        <th>Nurse</th>
                        <th>Time</th>
                        <th>Ward</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model)
                    {
                        <tr>
                            <td>@item.Patient.IdNumber</td>
                            <td>@item.Patient.Lastname</td>
                            <td>@item.Patient.Gender</td>
                            <td>@item.ApplicationUser.FirstName &nbsp;@item.ApplicationUser.LastName</td>
                            <td>@item.AdmissionDate.ToShortTimeString()</td>
                            <td>@item.Ward.WardName - @item.Bed.BedName</td>
                            <td>
                                <a class="btn btn-primary btn-sm" onclick="openPatientVitalsModal('@Url.Action("ViewPatientVitals", "Admission", new { admissionId = item.Id })')">View vitals</a>
                                <a class="btn btn-secondary btn-sm" onclick="openViewPrescriptionModal('@Url.Action("ViewPrescription", "Admission", new { admissionId = item.Id })')">View prescription</a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>


            <div class="form-container d-flex">
                <div class="mt-3 add-vitals-form">
                    <form asp-action="AddVitals" asp-controller="Admission" method="get" class="form-inline">
                        <div class="form-group">
                            <label for="selectAdmissionId" class="mr-2">Admission:</label>
                            <select id="selectAdmissionId" name="admissionId" class="form-control mr-2">
                                @foreach (var item in Model)
                                {
                                    <option value="@item.Id">@item.Patient.Lastname - @item.AdmissionDate.ToShortDateString()</option>
                                }
                            </select>
                            <button type="button" class="btn btn-info" onclick="openReCaptureVitalsModal()">Re-Capture Vitals</button>
                        </div>
                    </form>
                </div>
                <div class="mt-3 discharge-form ml-auto">
                    <form asp-action="Discharge" asp-controller="Admission" method="get" class="form-inline">
                        <div class="form-group">
                            <label for="selectAdmissionId" class="mr-2">Admission:</label>
                            <select id="selectAdmissionId" name="admissionId" class="form-control mr-2">
                                @foreach (var item in Model)
                                {
                                    <option value="@item.Id">@item.Patient.Lastname - @item.AdmissionDate.ToShortTimeString()</option>
                                }
                            </select>
                            <button type="button" class="btn btn-danger" onclick="openDischargeModal()">Discharge Patient</button>
                        </div>
                    </form>
                </div>
            </div>
        }
        else
        {
            <p>Search For Admission</p>
        }
    </div>

</div>
<!-- Patient Vitals Modal -->
<div class="modal fade" id="patientVitalsModal" tabindex="-1" role="dialog" aria-labelledby="patientVitalsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title text-center" id="patientVitalsModalLabel">Patient Vitals</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="patientVitalsModalBody">
                <!-- Content loaded dynamically -->
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<!-- Re-Capture Vitals Modal -->
<div class="modal fade" id="reCaptureVitalsModal" tabindex="-1" role="dialog" aria-labelledby="reCaptureVitalsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title text-center" id="reCaptureVitalsModalLabel">Re-Capture Vitals</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="reCaptureVitalsModalBody">
                <!-- Content loaded dynamically -->
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<!-- Discharge Modal -->
<div class="modal fade" id="DischargeModal" tabindex="-1" role="dialog" aria-labelledby="DischargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title text-center" id="DischargeModalLabel">Re-Capture Vitals</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="DischargeModalBody">
                <!-- Content loaded dynamically -->
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<!-- View Prescription Modal -->
<div class="modal fade" id="viewPrescriptionModal" tabindex="-1" role="dialog" aria-labelledby="viewPrescriptionModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title text-center" id="viewPrescriptionModalLabel">Prescription Details</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="viewPrescriptionModalBody">
                <!-- Content loaded dynamically -->
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function openPatientVitalsModal(url) {
            $('#patientVitalsModalBody').load(url, function () {
                $('#patientVitalsModal').modal('show');
            });
        }

        javascript

        function openReCaptureVitalsModal() {
            var selectedAdmissionId = $('#selectAdmissionId').val();
            var url = '@Url.Action("AddVitals", "Admission")' + '?admissionId=' + selectedAdmissionId;
            $('#reCaptureVitalsModalBody').load(url, function () {
                $('#reCaptureVitalsModal').modal('show');
            });
        }

        function openDischargeModal() {
            var selectedAdmissionId = $('#selectAdmissionId').val();
            var url = '@Url.Action("Discharge", "Admission")' + '?admissionId=' + selectedAdmissionId;
            $('#DischargeModalBody').load(url, function () {
                $('#DischargeModal').modal('show');
            });
        }

        function openViewPrescriptionModal(url) {
            $('#viewPrescriptionModalBody').load(url, function () {
                $('#viewPrescriptionModal').modal('show');
            });
        }
    </script>

}